<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PromptInSTYL</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --bg-primary: #1a1a1a;
        --bg-secondary: #2d2d2d;
        --bg-tertiary: #3a3a3a;
        --text-primary: #ffffff;
        --text-secondary: #b3b3b3;
        --text-tertiary: #808080;
        --border-color: #404040;
        --accent-blue: #3b82f6;
        --accent-orange: #f59e0b;
        --sidebar-width: 280px;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        height: 100vh;
        overflow: hidden;
      }

      .app-container {
        display: flex;
        height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: var(--sidebar-width);
        background: var(--bg-secondary);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        transition: transform 0.3s ease;
      }

      .sidebar.collapsed {
        transform: translateX(-100%);
      }

      .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid var(--border-color);
      }

      .new-chat-btn {
        width: 100%;
        padding: 12px 16px;
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
      }

      .new-chat-btn:hover {
        background: var(--bg-primary);
      }

      /* Chat History */
      .chat-history {
        flex: 1;
        padding: 12px;
        overflow-y: auto;
      }

      .history-section {
        margin-bottom: 24px;
      }

      .history-section h3 {
        font-size: 12px;
        font-weight: 500;
        color: var(--text-tertiary);
        margin-bottom: 8px;
        padding: 0 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .history-item {
        padding: 8px 12px;
        margin-bottom: 2px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 13px;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .history-item:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
      }

      .history-item.active {
        background: var(--accent-blue);
        color: white;
      }

      .history-icon {
        width: 16px;
        height: 16px;
        opacity: 0.6;
      }

      .history-text {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      /* User Account */
      .user-account {
        padding: 16px;
        border-top: 1px solid var(--border-color);
        background: var(--bg-primary);
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .user-info:hover {
        background: var(--bg-tertiary);
      }

      .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--accent-blue);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 600;
      }

      .user-details {
        flex: 1;
      }

      .user-name {
        font-size: 14px;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 2px;
      }

      .user-email {
        font-size: 11px;
        color: var(--text-secondary);
      }

      /* Main Content */
      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      .main-header {
        padding: 16px 24px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .sidebar-toggle {
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        padding: 8px;
        border-radius: 6px;
        transition: all 0.2s;
      }

      .sidebar-toggle:hover {
        background: var(--bg-secondary);
        color: var(--text-primary);
      }

      .main-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
      }

      /* Center Welcome Area */
      .welcome-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px;
        text-align: center;
      }

      .logo-large {
        width: 80px;
        height: 80px;
        margin-bottom: 24px;
        opacity: 0.9;
      }

      .brand-title {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 8px;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .brand-subtitle {
        font-size: 16px;
        color: var(--text-secondary);
        margin-bottom: 40px;
      }

      /* Input Area */
      .input-area {
        padding: 24px;
        border-top: 1px solid var(--border-color);
        background: var(--bg-secondary);
      }

      .input-container {
        max-width: 800px;
        margin: 0 auto;
        position: relative;
      }

      .input-wrapper {
        position: relative;
        display: flex;
        align-items: flex-end;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 16px;
        transition: all 0.2s;
      }

      .input-wrapper:focus-within {
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .prompt-input {
        flex: 1;
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 16px;
        line-height: 1.5;
        resize: none;
        outline: none;
        font-family: inherit;
        min-height: 24px;
        max-height: 200px;
        overflow-y: auto;
      }

      .prompt-input::placeholder {
        color: var(--text-tertiary);
      }

      .send-button {
        width: 40px;
        height: 40px;
        background: var(--accent-blue);
        border: none;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        margin-left: 12px;
      }

      .send-button:hover {
        background: #2563eb;
        transform: translateY(-1px);
      }

      .send-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .char-count {
        position: absolute;
        bottom: -24px;
        right: 0;
        font-size: 11px;
        color: var(--text-tertiary);
      }

      /* Chat Messages Area */
      .messages-area {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        display: none; /* Hidden until first message */
      }

      .message {
        margin-bottom: 24px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }

      .message.user {
        text-align: right;
      }

      .message.assistant {
        text-align: left;
      }

      .message-content {
        display: inline-block;
        padding: 16px 20px;
        border-radius: 16px;
        max-width: 80%;
        word-wrap: break-word;
      }

      .message.user .message-content {
        background: var(--accent-blue);
        color: white;
      }

      .message.assistant .message-content {
        background: var(--bg-secondary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
      }

      .typing-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 14px;
        margin: 20px auto;
        max-width: 800px;
      }

      .typing-dots {
        display: flex;
        gap: 4px;
      }

      .typing-dot {
        width: 6px;
        height: 6px;
        background: var(--text-secondary);
        border-radius: 50%;
        animation: typing 1.4s infinite ease-in-out;
      }

      .typing-dot:nth-child(1) {
        animation-delay: -0.32s;
      }
      .typing-dot:nth-child(2) {
        animation-delay: -0.16s;
      }

      @keyframes typing {
        0%,
        80%,
        100% {
          opacity: 0.3;
        }
        40% {
          opacity: 1;
        }
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          z-index: 1000;
          height: 100vh;
        }

        .main-content {
          margin-left: 0;
        }

        .sidebar-toggle {
          display: block;
        }
      }

      /* Utility Classes */
      .hidden {
        display: none !important;
      }

      .fade-in {
        animation: fadeIn 0.3s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- Sidebar -->
      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <button class="new-chat-btn" id="newChatBtn">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M12 5v14m-7-7h14" />
            </svg>
            New Chat
          </button>
        </div>

        <!-- Chat History -->
        <div class="chat-history" id="chatHistory">
          <div class="history-section">
            <h3>Recent</h3>
            <div id="recentHistory">
              <!-- Recent conversations will be populated here -->
            </div>
          </div>

          <div class="history-section">
            <h3>Earlier</h3>
            <div id="earlierHistory">
              <!-- Older conversations will be populated here -->
            </div>
          </div>
        </div>

        <!-- User Account -->
        <div class="user-account">
          <div class="user-info" id="userInfo">
            <div class="user-avatar" id="userAvatar">U</div>
            <div class="user-details">
              <div class="user-name" id="userName">User</div>
              <div class="user-email" id="userEmail">user@example.com</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Header -->
        <div class="main-header">
          <button class="sidebar-toggle" id="sidebarToggle">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="3" y1="6" x2="21" y2="6" />
              <line x1="3" y1="12" x2="21" y2="12" />
              <line x1="3" y1="18" x2="21" y2="18" />
            </svg>
          </button>
          <div class="main-title">PromptInSTYL</div>
        </div>

        <!-- Welcome Area (shown when no conversation) -->
        <div class="welcome-area" id="welcomeArea">
          <svg class="logo-large" viewBox="0 0 24 24" fill="none">
            <rect width="24" height="24" rx="6" fill="url(#gradient)" />
            <path
              d="M12 8L8 12L12 16M16 8L12 12L16 16"
              stroke="white"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <defs>
              <linearGradient id="gradient" x1="0" y1="0" x2="24" y2="24">
                <stop offset="0%" stop-color="#3B82F6" />
                <stop offset="100%" stop-color="#8B5CF6" />
              </linearGradient>
            </defs>
          </svg>

          <h1 class="brand-title">PromptInSTYL</h1>
          <p class="brand-subtitle">by STYL Digital Solutions</p>

          <div class="welcome-features">
            <div class="feature">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z" />
              </svg>
              <span>1200+ AI Frameworks</span>
            </div>
            <div class="feature">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M12 2L13.09 8.26L22 9L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9L8.91 8.26L12 2Z"
                />
              </svg>
              <span>Expert-Level Prompts</span>
            </div>
            <div class="feature">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M13 2L3 14h9l1 8 10-12h-9l-1-8z" />
              </svg>
              <span>Instant Meta-Prompts</span>
            </div>
          </div>
        </div>

        <!-- Messages Area (hidden initially) -->
        <div class="messages-area" id="messagesArea">
          <div id="messagesList"></div>
          <div class="typing-indicator hidden" id="typingIndicator">
            <div class="typing-dots">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
            <span>PromptInSTYL is thinking...</span>
          </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
          <div class="input-container">
            <div class="input-wrapper">
              <textarea
                id="promptInput"
                class="prompt-input"
                placeholder="Describe your request..."
                rows="1"
              ></textarea>
              <button class="send-button" id="sendButton" disabled>
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M3 12h18m-9-9l9 9-9 9" />
                </svg>
              </button>
            </div>
            <div class="char-count" id="charCount">0 / 2000</div>
          </div>
        </div>
      </div>
    </div>

    <style>
      .welcome-features {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 32px;
      }

      .feature {
        display: flex;
        align-items: center;
        gap: 12px;
        color: var(--text-secondary);
        font-size: 14px;
      }

      .feature svg {
        color: var(--accent-blue);
      }
    </style>

    <script>
      class PromptInSTYLWebApp {
        constructor() {
          this.apiBase = "http://localhost:3000/api";
          this.currentUser = null;
          this.conversations = [];
          this.currentConversationId = null;

          this.initializeElements();
          this.checkAuth();
          this.setupEventListeners();
          this.loadUserHistory();
        }

        initializeElements() {
          this.sidebar = document.getElementById("sidebar");
          this.sidebarToggle = document.getElementById("sidebarToggle");
          this.newChatBtn = document.getElementById("newChatBtn");
          this.userAvatar = document.getElementById("userAvatar");
          this.userName = document.getElementById("userName");
          this.userEmail = document.getElementById("userEmail");
          this.userInfo = document.getElementById("userInfo");

          this.welcomeArea = document.getElementById("welcomeArea");
          this.messagesArea = document.getElementById("messagesArea");
          this.messagesList = document.getElementById("messagesList");
          this.typingIndicator = document.getElementById("typingIndicator");

          this.promptInput = document.getElementById("promptInput");
          this.sendButton = document.getElementById("sendButton");
          this.charCount = document.getElementById("charCount");

          this.recentHistory = document.getElementById("recentHistory");
          this.earlierHistory = document.getElementById("earlierHistory");
        }

        checkAuth() {
          const urlParams = new URLSearchParams(window.location.search);
          const token = urlParams.get("token");

          if (token) {
            // Mock user from token
            this.currentUser = {
              uid: token,
              email: "user@example.com",
              displayName: "User",
            };
            this.updateUserDisplay();
          } else {
            this.showAuthRequired();
          }
        }

        showAuthRequired() {
          document.body.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; flex-direction: column; gap: 20px; text-align: center; background: var(--bg-primary); color: var(--text-primary);">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                            <rect width="24" height="24" rx="6" fill="url(#gradient)"/>
                            <path d="M12 8L8 12L12 16M16 8L12 12L16 16" stroke="white" stroke-width="2"/>
                            <defs>
                                <linearGradient id="gradient" x1="0" y1="0" x2="24" y2="24">
                                    <stop offset="0%" stop-color="#3B82F6"/>
                                    <stop offset="100%" stop-color="#8B5CF6"/>
                                </linearGradient>
                            </defs>
                        </svg>
                        <h2 style="font-size: 24px; margin-bottom: 8px;">Welcome to PromptInSTYL</h2>
                        <p style="color: var(--text-secondary); max-width: 400px; margin-bottom: 24px;">
                            Please sign in through the Chrome extension to access the web app.
                        </p>
                        <button onclick="window.close()" style="padding: 12px 24px; background: var(--accent-blue); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
                            Install Extension
                        </button>
                    </div>
                `;
        }

        updateUserDisplay() {
          if (this.currentUser) {
            const initials = this.currentUser.displayName
              ? this.currentUser.displayName
                  .split(" ")
                  .map((n) => n[0])
                  .join("")
                  .toUpperCase()
              : this.currentUser.email[0].toUpperCase();

            this.userAvatar.textContent = initials;
            this.userName.textContent =
              this.currentUser.displayName ||
              this.currentUser.email.split("@")[0];
            this.userEmail.textContent = this.currentUser.email;
          }
        }

        setupEventListeners() {
          // Sidebar toggle
          this.sidebarToggle?.addEventListener("click", () => {
            this.sidebar.classList.toggle("collapsed");
          });

          // New chat
          this.newChatBtn?.addEventListener("click", () => {
            this.startNewChat();
          });

          // Input handling
          this.promptInput?.addEventListener("input", () => {
            this.handleInputChange();
          });

          this.promptInput?.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) {
              e.preventDefault();
              this.sendMessage();
            }
          });

          this.sendButton?.addEventListener("click", () => {
            this.sendMessage();
          });

          // User account menu
          this.userInfo?.addEventListener("click", () => {
            this.showUserMenu();
          });
        }

        handleInputChange() {
          const text = this.promptInput.value;
          const length = text.length;

          this.charCount.textContent = `${length} / 2000`;
          this.sendButton.disabled = length < 5 || length > 2000;

          // Auto-resize textarea
          this.promptInput.style.height = "auto";
          this.promptInput.style.height =
            Math.min(this.promptInput.scrollHeight, 200) + "px";
        }

        async sendMessage() {
          const text = this.promptInput.value.trim();
          if (!text || text.length < 5) return;

          // Add user message
          this.addMessage(text, "user");

          // Clear input
          this.promptInput.value = "";
          this.handleInputChange();

          // Show typing indicator
          this.showTyping();

          // Hide welcome area and show messages
          this.welcomeArea.style.display = "none";
          this.messagesArea.style.display = "block";

          try {
            // Generate enhanced prompt
            const response = await fetch(
              `${this.apiBase}/generate-adaptive-prompt`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "User-ID": this.currentUser?.uid || "anonymous",
                },
                body: JSON.stringify({
                  userRequest: text,
                  preferences: {
                    outputFormat: "detailed",
                    tone: "expert",
                    role: "specialist",
                  },
                }),
              }
            );

            if (!response.ok) throw new Error("Failed to generate prompt");

            const result = await response.json();

            if (result.success) {
              const prompt =
                result.data.prompt?.prompt || result.data.prompt || result.data;
              this.addMessage(prompt, "assistant");

              // Save to history
              this.saveToHistory({
                request: text,
                response: prompt,
                timestamp: new Date().toISOString(),
              });
            }
          } catch (error) {
            console.error("Generation error:", error);
            this.addMessage(
              "Sorry, I encountered an error generating your prompt. Please try again.",
              "assistant"
            );
          } finally {
            this.hideTyping();
          }
        }

        addMessage(content, type) {
          const messageDiv = document.createElement("div");
          messageDiv.className = `message ${type}`;

          const contentDiv = document.createElement("div");
          contentDiv.className = "message-content";
          contentDiv.textContent = content;

          messageDiv.appendChild(contentDiv);
          this.messagesList.appendChild(messageDiv);

          // Scroll to bottom
          this.messagesArea.scrollTop = this.messagesArea.scrollHeight;
        }

        showTyping() {
          this.typingIndicator.classList.remove("hidden");
          this.messagesArea.scrollTop = this.messagesArea.scrollHeight;
        }

        hideTyping() {
          this.typingIndicator.classList.add("hidden");
        }

        startNewChat() {
          this.currentConversationId = null;
          this.messagesList.innerHTML = "";
          this.messagesArea.style.display = "none";
          this.welcomeArea.style.display = "flex";
          this.promptInput.focus();
        }

        async saveToHistory(conversation) {
          if (!this.currentUser) return;

          try {
            const historyItem = {
              id: Date.now().toString(),
              title:
                conversation.request.substring(0, 50) +
                (conversation.request.length > 50 ? "..." : ""),
              request: conversation.request,
              response: conversation.response,
              timestamp: conversation.timestamp,
              userId: this.currentUser.uid,
            };

            // Add to local conversations
            this.conversations.unshift(historyItem);

            // Update sidebar
            this.updateHistoryDisplay();

            // Save to backend
            await fetch(`${this.apiBase}/history`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "User-ID": this.currentUser.uid,
              },
              body: JSON.stringify({
                userId: this.currentUser.uid,
                type: "generation",
                request: conversation.request,
                prompt: conversation.response,
                framework: "Universal Enhancement",
              }),
            });
          } catch (error) {
            console.warn("Failed to save history:", error);
          }
        }

        async loadUserHistory() {
          if (!this.currentUser) return;

          try {
            const response = await fetch(
              `${this.apiBase}/history/${this.currentUser.uid}`
            );
            if (response.ok) {
              const result = await response.json();
              this.conversations = result.data || [];
              this.updateHistoryDisplay();
            }
          } catch (error) {
            console.warn("Failed to load history:", error);
          }
        }

        updateHistoryDisplay() {
          const now = new Date();
          const today = new Date(
            now.getFullYear(),
            now.getMonth(),
            now.getDate()
          );
          const yesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000);

          const recent = [];
          const earlier = [];

          this.conversations.forEach((conv) => {
            const convDate = new Date(conv.timestamp);
            if (convDate >= today) {
              recent.push(conv);
            } else if (convDate >= yesterday) {
              recent.push({ ...conv, timeLabel: "Yesterday" });
            } else {
              earlier.push(conv);
            }
          });

          // Update recent history
          this.recentHistory.innerHTML = recent.length
            ? recent.map((conv) => this.createHistoryItem(conv)).join("")
            : '<div style="padding: 8px; color: var(--text-tertiary); font-size: 12px;">No recent conversations</div>';

          // Update earlier history
          this.earlierHistory.innerHTML = earlier.length
            ? earlier.map((conv) => this.createHistoryItem(conv)).join("")
            : '<div style="padding: 8px; color: var(--text-tertiary); font-size: 12px;">No earlier conversations</div>';
        }

        createHistoryItem(conversation) {
          const timeAgo = this.formatTimeAgo(new Date(conversation.timestamp));
          return `
                    <div class="history-item" onclick="app.loadConversation('${conversation.id}')">
                        <svg class="history-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                        </svg>
                        <div class="history-text">${conversation.title}</div>
                    </div>
                `;
        }

        loadConversation(conversationId) {
          const conversation = this.conversations.find(
            (c) => c.id === conversationId
          );
          if (!conversation) return;

          this.currentConversationId = conversationId;
          this.messagesList.innerHTML = "";

          // Show the conversation
          this.addMessage(conversation.request, "user");
          this.addMessage(conversation.response, "assistant");

          this.welcomeArea.style.display = "none";
          this.messagesArea.style.display = "block";
        }

        formatTimeAgo(date) {
          const now = new Date();
          const diffMinutes = Math.floor((now - date) / (1000 * 60));

          if (diffMinutes < 1) return "Just now";
          if (diffMinutes < 60) return `${diffMinutes}m ago`;

          const diffHours = Math.floor(diffMinutes / 60);
          if (diffHours < 24) return `${diffHours}h ago`;

          const diffDays = Math.floor(diffHours / 24);
          if (diffDays < 7) return `${diffDays}d ago`;

          return date.toLocaleDateString();
        }

        showUserMenu() {
          // Simple sign out for now
          if (confirm("Sign out of PromptInSTYL?")) {
            window.location.href = "/";
          }
        }
      }

      // Initialize app
      let app;
      document.addEventListener("DOMContentLoaded", () => {
        app = new PromptInSTYLWebApp();
      });
    </script>
  </body>
</html>
